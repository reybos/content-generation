# Улучшения системы локов

## Проблема
При перемещении папок из `in-progress` в `processed` или `failed` файл `.lock` оставался в папке, что могло приводить к проблемам при повторной обработке или создавать "мусорные" файлы блокировок.

## Решение

### 1. Добавлен метод `forceRemoveLock` в `LockService`
```typescript
/**
 * Force remove lock file without checking ownership
 * Useful when moving folders between directories
 */
public async forceRemoveLock(folderPath: string): Promise<void>
```

Этот метод позволяет принудительно удалить файл `.lock` без проверки владельца блокировки, что необходимо при перемещении папок между директориями.

### 2. Обновлены методы в `FileService`

#### `moveProcessedFolder`
- Автоматически удаляет `.lock` файл перед перемещением папки в `processed`
- Использует `forceRemoveLock` для безопасного удаления

#### `moveFailedFolder`
- Автоматически удаляет `.lock` файл перед перемещением папки в `failed`
- Использует `forceRemoveLock` для безопасного удаления

### 3. Упрощен код в `UniversalWorker`
- Удалены блоки `finally` с ручным освобождением блокировок
- Блокировки теперь автоматически удаляются при перемещении папок
- Код стал более чистым и менее подверженным ошибкам

## Преимущества

1. **Автоматическая очистка**: Файлы `.lock` автоматически удаляются при перемещении папок
2. **Предотвращение конфликтов**: Исключена возможность "зависших" блокировок
3. **Упрощение кода**: Убрана необходимость ручного управления блокировками
4. **Надежность**: Система стала более устойчивой к ошибкам

## Тестирование

Создан и успешно выполнен тест, подтверждающий корректную работу системы:
- Создание папки с `.lock` файлом
- Удаление `.lock` файла перед перемещением
- Перемещение папки в целевую директорию
- Проверка отсутствия `.lock` файла в новой папке

## Совместимость

Изменения полностью совместимы с существующим кодом и не требуют изменений в других частях системы. 